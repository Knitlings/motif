<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Motif</title>
    <meta name="description" content="Create and preview tiled grid patterns with multiple colors">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Ruda:wght@400..900&family=Libre+Franklin:ital,wght@0,100..900;1,100..900&family=Palanquin:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/src/styles/main.css">
</head>
<body>
    <!-- Skip to main content link for keyboard users -->
    <a href="#editCanvas" class="skip-link">Skip to main canvas</a>

    <div class="main-layout" role="application" aria-label="Motif Pattern Editor">
        <!-- Left Panel: Colors -->
        <aside class="side-panel left-panel collapsed" id="colorPanel" aria-label="Color controls" aria-expanded="false">
            <div class="panel-content">
                <button class="panel-close-btn" id="colorPanelClose" aria-label="Close color panel">×</button>
                <!-- Pattern Color Selector -->
                <div>
                    <h3>Pattern Colours</h3>
                    <div class="input-group">
                        <div id="patternColorButtons" role="group" aria-label="Pattern color selector" style="display: grid; gap: 5px; margin-bottom: 10px;">
                            <!-- Buttons will be generated by JS -->
                        </div>
                        <p id="mergeHint" class="hint" style="display: none;">Drag one color onto another to merge</p>
                    </div>
                </div>

                <!-- Active Pattern Color Editor -->
                <div>
                    <h3>Active Colour</h3>
                    <div class="input-group">
                        <div class="color-input-row">
                            <div class="color-picker-wrapper">
                                <input type="color" id="activePatternColor" value="#8d2e3e" aria-label="Active pattern color picker">
                                <div class="color-picker-label" aria-hidden="true">1</div>
                            </div>
                            <input type="text" id="activePatternText" value="#8d2e3e" aria-label="Active pattern color hex value">
                        </div>
                    </div>
                </div>

                <!-- Background Color -->
                <div>
                    <h3>Background</h3>
                    <div class="input-group">
                        <div class="color-input-row">
                            <input type="color" id="backgroundColor" value="#fdf9f8" aria-label="Background color picker">
                            <input type="text" id="backgroundText" value="#fdf9f8" aria-label="Background color hex value">
                        </div>
                        <a href="#" id="invertBtn" class="text-link-label" aria-label="Switch active and background colors">Switch with active colour</a>
                    </div>
                </div>

                <!-- Quick Palette -->
                <div>
                    <div class="palette-header">
                        <h3>Palette: <span id="paletteName">Motif</span></h3>
                        <div class="dropdown-container palette-dropdown">
                            <button class="dropdown-btn" id="paletteDropdownBtn" aria-haspopup="true" aria-expanded="false" aria-label="Select palette">
                                <span class="dropdown-arrow" aria-hidden="true">▾</span>
                            </button>
                            <div class="dropdown-menu" id="paletteMenu" role="menu">
                                <a href="#" class="dropdown-item palette-option" data-palette="motif" role="menuitem">Motif</a>
                                <a href="#" class="dropdown-item palette-option" data-palette="warm" role="menuitem">Warm</a>
                                <a href="#" class="dropdown-item palette-option" data-palette="cool" role="menuitem">Cool</a>
                                <a href="#" class="dropdown-item palette-option" data-palette="autumn" role="menuitem">Autumn</a>
                                <a href="#" class="dropdown-item palette-option" data-palette="custom" role="menuitem">Custom</a>
                            </div>
                        </div>
                    </div>
                    <div class="input-group">
                        <div class="palette-grid" id="paletteGrid" role="group" aria-label="Quick color palette"></div>
                        <a href="#" id="loadPaletteBtn" class="text-link-label" aria-label="Load palette to pattern colors">Load palette to pattern colours</a>
                        <p class="hint desktop-only">Shift+click to set background colour</p>
                        <p class="hint mobile-only">Long press to set background colour</p>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Header Navigation Bar -->
        <header class="header-navbar" role="banner">
            <div class="navbar-left">
                <button class="navbar-color-swatch-toggle" id="navbarColorToggle" aria-label="Toggle color panel" aria-controls="colorPanel" title="Click to edit colors">
                    <div class="color-swatch-container">
                        <div class="color-swatch active-swatch" id="navbarActiveColorSwatch"></div>
                        <div class="color-swatch bg-swatch" id="navbarBgColorSwatch"></div>
                    </div>
                </button>
                <div class="navbar-branding">
                    <span class="navbar-title">Motif</span>
                </div>
            </div>
            <div class="navbar-center">
                <div id="navbarColorPreview" class="navbar-color-preview" role="status" aria-label="Current pattern colors"></div>
            </div>
            <div class="navbar-right">
                <nav class="navbar-nav" aria-label="Main navigation">
                    <div class="navbar-dropdown-container">
                        <button class="navbar-dropdown-btn" id="navbarImportExportBtn" aria-haspopup="true" aria-expanded="false">
                            Import/Export
                            <span class="navbar-dropdown-arrow" aria-hidden="true">▾</span>
                        </button>
                        <div class="navbar-dropdown-menu" id="navbarImportExportMenu" role="menu">
                            <label for="navbarImportJsonInput" class="dropdown-item" role="menuitem" tabindex="0">Import JSON</label>
                            <a href="#" id="navbarExportJsonBtn" class="dropdown-item" role="menuitem">Export JSON</a>
                        </div>
                        <input type="file" id="navbarImportJsonInput" accept=".json" style="display: none;" aria-label="Import JSON file">
                    </div>
                    <a href="/about.html" class="navbar-link">About</a>
                    <a href="/help.html" class="navbar-link">Help</a>
                </nav>
                <button class="navbar-panel-toggle" id="navbarSettingsToggle" aria-label="Toggle settings panel" aria-controls="settingsPanel">
                    <img src="grid3x3.svg" class="navbar-grid-svg" alt="Settings icon">
                </button>
            </div>
        </header>

        <!-- Center Area: Canvas -->
        <main class="center-area" role="main">
            <!-- Status announcements for screen readers -->
            <div id="statusAnnouncements" class="sr-only" role="status" aria-live="polite" aria-atomic="true"></div>

            <!-- Canvas Container -->
            <div class="canvas-container">
                <!-- Create Canvas -->
                <section class="canvas-section" aria-labelledby="create-heading">
                    <h2 id="create-heading" class="canvas-heading">Create</h2>
                    <div class="canvas-wrapper">
                        <div class="canvas-resize-container">
                            <canvas id="editCanvas" role="img" aria-label="Grid pattern editor canvas - click to paint, shift-click to erase"></canvas>
                            <div id="canvasInstructions" class="canvas-instructions" aria-hidden="true">
                                <div class="canvas-instructions-text hint">
                                    Click to paint<br>
                                    Shift+click to erase
                                </div>
                            </div>
                            <div class="resize-handle resize-handle-top" data-direction="top" role="button" tabindex="0" aria-label="Resize grid from top"></div>
                            <div class="resize-handle resize-handle-right" data-direction="right" role="button" tabindex="0" aria-label="Resize grid from right"></div>
                            <div class="resize-handle resize-handle-bottom" data-direction="bottom" role="button" tabindex="0" aria-label="Resize grid from bottom"></div>
                            <div class="resize-handle resize-handle-left" data-direction="left" role="button" tabindex="0" aria-label="Resize grid from left"></div>
                        </div>
                    </div>
                    <div class="header-actions" role="toolbar" aria-label="Canvas actions">
                        <button class="icon-btn" id="undoBtn" aria-label="Undo (Ctrl+Z)"><span aria-hidden="true">↶</span></button>
                        <button class="icon-btn" id="redoBtn" aria-label="Redo (Ctrl+Y)"><span aria-hidden="true">↷</span></button>
                        <button class="icon-btn icon-btn-danger" id="clearBtn" aria-label="Clear canvas (Delete)"><span aria-hidden="true">✕</span></button>
                        <div class="dropdown-container">
                            <button class="dropdown-btn" id="saveBtn" aria-haspopup="true" aria-expanded="false">
                                Download pattern
                                <span class="dropdown-arrow" aria-hidden="true">▾</span>
                            </button>
                            <div class="dropdown-menu" id="saveMenu" role="menu">
                                <a href="#" id="exportPngBtn" class="dropdown-item" role="menuitem">Download as PNG</a>
                                <a href="#" id="exportSvgBtn" class="dropdown-item" role="menuitem">Download as SVG</a>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Preview Canvas -->
                <section class="canvas-section" aria-labelledby="preview-heading">
                    <h2 id="preview-heading" class="canvas-heading">Preview</h2>
                    <div class="canvas-wrapper">
                        <canvas id="previewCanvas" role="img" aria-label="Tiled pattern preview"></canvas>
                    </div>
                </section>
            </div>
        </main>

        <!-- Right Panel: Settings -->
        <aside class="side-panel right-panel collapsed" id="settingsPanel" aria-label="Settings controls" aria-expanded="false">
            <div class="panel-content">
                <button class="panel-close-btn" id="settingsPanelClose" aria-label="Close settings panel">×</button>
                <!-- Grid Dimensions -->
                <div>
                    <h3>Grid Dimensions</h3>
                    <div class="input-group">
                        <label for="gridWidth2">Width: <span id="widthDisplay2">5</span> <span class="hint">(2-100)</span></label>
                        <input type="number" id="gridWidth2" min="2" max="100" value="5" aria-label="Grid width">
                    </div>
                    <div class="input-group">
                        <label for="gridHeight2">Height: <span id="heightDisplay2">5</span> <span class="hint">(2-100)</span></label>
                        <input type="number" id="gridHeight2" min="2" max="100" value="5" aria-label="Grid height">
                    </div>
                </div>

                <!-- Aspect Ratio -->
                <div>
                    <h3>Cell Aspect Ratio</h3>
                    <div class="ratio-preset-group" role="group" aria-label="Aspect ratio presets">
                        <button class="ratio-preset-btn active" data-ratio="1.0" aria-pressed="true">Square 1:1</button>
                        <button class="ratio-preset-btn" data-ratio="0.75" aria-pressed="false">Knit 4:3</button>
                        <button class="ratio-preset-btn" data-ratio="custom" aria-pressed="false">Custom</button>
                    </div>
                    <div class="input-group" id="customRatioControls" style="display: none; margin-top: var(--space-3);">
                        <label for="aspectRatio2">Ratio: <span id="ratioDisplay2" contenteditable="true" role="textbox" aria-label="Custom aspect ratio" style="cursor: text;">1:1</span> <span class="hint">(10:1 to 1:10)</span></label>
                        <input type="range" id="aspectRatio2" min="0.1" max="10" step="0.1" value="1" aria-label="Aspect ratio slider">
                    </div>
                </div>

                <!-- Preview Repeats -->
                <div>
                    <h3>Preview Repeats</h3>
                    <div class="input-group">
                        <label for="previewRepeatX">Horizontal: <span id="repeatXDisplay">3</span> <span class="hint">(1-10)</span></label>
                        <input type="number" id="previewRepeatX" min="1" max="10" value="3" aria-label="Horizontal repeat count">
                    </div>
                    <div class="input-group">
                        <label for="previewRepeatY">Vertical: <span id="repeatYDisplay">3</span> <span class="hint">(1-10)</span></label>
                        <input type="number" id="previewRepeatY" min="1" max="10" value="3" aria-label="Vertical repeat count">
                    </div>
                </div>
            </div>
        </aside>
    </div>

    <!-- Custom Confirmation Dialog -->
    <div id="mergeDialog" role="dialog" aria-modal="true" aria-labelledby="mergeDialogTitle" aria-describedby="mergeDialogText">
        <div>
            <h2 id="mergeDialogTitle">Merge Pattern Colors?</h2>
            <p id="mergeDialogText"></p>
            <div class="dialog-buttons">
                <button id="mergeCancelBtn">Cancel</button>
                <button id="mergeConfirmBtn" class="btn-primary">Merge</button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay" aria-live="polite" aria-atomic="true" style="display: none;">
        <div class="loading-spinner"></div>
        <p id="loadingMessage">Processing...</p>
    </div>

    <script type="module" src="src/main.js"></script>
</body>
</html>
