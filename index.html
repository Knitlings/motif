<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; font-src 'self'; img-src 'self' data: blob:; connect-src 'self'; object-src 'none'; base-uri 'self'; form-action 'none'; frame-ancestors 'none';">
    <title>Motif</title>
    <meta name="description" content="Create and preview tiled grid patterns with multiple colors">
    <link rel="stylesheet" href="/src/assets/fonts/fonts.css">
    <link rel="stylesheet" href="/src/styles/main.css">
</head>
<body>
    <!-- Skip to main content link for keyboard users -->
    <a href="#editCanvas" class="skip-link">Skip to main canvas</a>

    <div class="main-layout" role="application" aria-label="Motif Pattern Editor">
        <!-- Left Panel: Colors (HIDDEN - functionality moved to navbar) -->
        <!-- Header Navigation Bar -->
        <header class="header-navbar" role="banner">
            <div class="navbar-left">
                <div class="navbar-branding">
                    <span class="navbar-title">Motif</span>
                </div>
            </div>
            <div class="navbar-center">
                <!-- Color Buttons Container -->
                <div class="navbar-color-buttons" id="navbarColorButtons" role="group" aria-label="Pattern color buttons">
                    <!-- Pattern color buttons will be generated by JS -->
                </div>

                <!-- Combined Palette Dropdown -->
                <div class="navbar-palette-dropdown-container">
                    <button class="navbar-palette-dropdown-btn" id="navbarPaletteDropdownBtn" aria-haspopup="true" aria-expanded="false" aria-label="Palette selector">
                        <div class="navbar-palette-preview" id="navbarPalettePreview">
                            <!-- 2x2 grid of palette colors will be generated by JS -->
                        </div>
                        <span class="navbar-dropdown-arrow" aria-hidden="true">▾</span>
                    </button>
                    <div class="navbar-palette-dropdown-menu" id="navbarPaletteMenu" role="menu">
                        <!-- Palette grid at top -->
                        <div class="navbar-palette-grid" id="navbarPaletteGrid" role="group" aria-label="Quick color palette"></div>
                        <button class="navbar-palette-load-btn" id="navbarLoadPaletteBtn" aria-label="Load palette to pattern colors">Load palette</button>
                        <!-- Palette selector list -->
                        <div class="navbar-palette-divider"></div>
                        <a href="#" class="navbar-palette-option" data-palette="motif" role="menuitem">Motif</a>
                        <a href="#" class="navbar-palette-option" data-palette="warm" role="menuitem">Warm</a>
                        <a href="#" class="navbar-palette-option" data-palette="cool" role="menuitem">Cool</a>
                        <a href="#" class="navbar-palette-option" data-palette="autumn" role="menuitem">Autumn</a>
                        <a href="#" class="navbar-palette-option" data-palette="custom" role="menuitem">Custom</a>
                    </div>
                </div>
            </div>
            <div class="navbar-right">
                <!-- Hamburger Menu -->
                <button class="navbar-hamburger-btn" id="navbarHamburgerBtn" aria-haspopup="true" aria-expanded="false" aria-label="Menu">
                    <span class="hamburger-icon" aria-hidden="true">
                        <span></span>
                        <span></span>
                        <span></span>
                    </span>
                </button>
                <div class="navbar-hamburger-menu" id="navbarHamburgerMenu" role="menu">
                    <label for="navbarImportJsonInput" class="navbar-hamburger-item" role="menuitem" tabindex="0">Import JSON</label>
                    <a href="#" id="navbarExportJsonBtn" class="navbar-hamburger-item" role="menuitem">Export JSON</a>
                    <div class="navbar-hamburger-divider"></div>
                    <button class="navbar-hamburger-item navbar-hamburger-expandable" id="cellAspectRatioToggle" aria-expanded="false" aria-controls="cellAspectRatioSection">
                        Cell Aspect Ratio
                        <span class="navbar-hamburger-arrow" aria-hidden="true">▾</span>
                    </button>
                    <div class="navbar-hamburger-section" id="cellAspectRatioSection" style="display: none;">
                        <div class="ratio-preset-group" role="group" aria-label="Aspect ratio presets">
                            <button class="ratio-preset-btn active" data-ratio="1.0" aria-pressed="true">Square 1:1</button>
                            <button class="ratio-preset-btn" data-ratio="0.75" aria-pressed="false">Knit stitch 4:3</button>
                            <button class="ratio-preset-btn" data-ratio="custom" aria-pressed="false">Custom</button>
                        </div>
                        <div class="input-group" id="customRatioControls" style="display: none; margin-top: var(--space-2);">
                            <!-- Using div instead of label to prevent focus stealing from contenteditable span -->
                            <div class="input-label-style">Ratio: <span id="ratioDisplay2" contenteditable="true" role="textbox" aria-label="Custom aspect ratio" style="cursor: text;">1:1</span> <span class="hint">(10:1 to 1:10)</span></div>
                            <input type="range" id="aspectRatio2" min="0.1" max="10" step="0.1" value="1" aria-label="Aspect ratio slider">
                        </div>
                    </div>
                    <div class="navbar-hamburger-divider"></div>
                    <a href="/about.html" class="navbar-hamburger-item" role="menuitem">About</a>
                    <a href="/help.html" class="navbar-hamburger-item" role="menuitem">Help</a>
                    <input type="file" id="navbarImportJsonInput" accept=".json" style="display: none;" aria-label="Import JSON file">
                </div>
            </div>
        </header>

        <!-- Center Area: Canvas -->
        <main class="center-area" role="main">
            <!-- Status announcements for screen readers -->
            <div id="statusAnnouncements" class="sr-only" role="status" aria-live="polite" aria-atomic="true"></div>

            <!-- Canvas Container -->
            <div class="canvas-container">
                <!-- Create Canvas -->
                <section class="canvas-section" aria-labelledby="create-heading">
                    <div id="create-heading" class="canvas-heading grid-control" role="region" aria-label="Grid dimensions">
                        <button class="grid-chevron grid-chevron-left" data-dimension="width" data-direction="decrease" aria-label="Add column to left (Shift+click or long-press to remove)">←</button>
                        <button class="grid-chevron grid-chevron-up" data-dimension="height" data-direction="decrease" aria-label="Add row to top (Shift+click or long-press to remove)">↑</button>
                        <span class="grid-control-label">Pattern</span>
                        <span class="grid-dimension" id="gridWidthDisplay" contenteditable="true" role="textbox" aria-label="Grid width" spellcheck="false">5</span>
                        <span class="grid-control-separator">×</span>
                        <span class="grid-dimension" id="gridHeightDisplay" contenteditable="true" role="textbox" aria-label="Grid height" spellcheck="false">5</span>
                        <button class="grid-chevron grid-chevron-down" data-dimension="height" data-direction="increase" aria-label="Add row to bottom (Shift+click or long-press to remove)">↓</button>
                        <button class="grid-chevron grid-chevron-right" data-dimension="width" data-direction="increase" aria-label="Add column to right (Shift+click or long-press to remove)">→</button>
                    </div>
                    <div class="canvas-wrapper">
                        <div class="canvas-resize-container">
                            <canvas id="editCanvas" role="img" aria-label="Grid pattern editor canvas - click to paint, shift-click to erase"></canvas>
                            <div id="canvasInstructions" class="canvas-instructions" aria-hidden="true">
                                <div class="canvas-instructions-text hint" id="canvasHint">
                                    <span class="desktop-hint">Click to paint<br>Shift+click to erase</span>
                                    <span class="touch-hint">Tap to paint<br>Tap again to erase</span>
                                </div>
                            </div>
                            <div class="resize-handle resize-handle-top" data-direction="top" role="button" tabindex="0" aria-label="Resize grid from top"></div>
                            <div class="resize-handle resize-handle-right" data-direction="right" role="button" tabindex="0" aria-label="Resize grid from right"></div>
                            <div class="resize-handle resize-handle-bottom" data-direction="bottom" role="button" tabindex="0" aria-label="Resize grid from bottom"></div>
                            <div class="resize-handle resize-handle-left" data-direction="left" role="button" tabindex="0" aria-label="Resize grid from left"></div>
                        </div>
                    </div>
                    <div class="header-actions" role="toolbar" aria-label="Canvas actions">
                        <button class="icon-btn" id="undoBtn" aria-label="Undo (Ctrl+Z)"><span aria-hidden="true">↶</span></button>
                        <button class="icon-btn" id="redoBtn" aria-label="Redo (Ctrl+Y)"><span aria-hidden="true">↷</span></button>
                        <button class="icon-btn icon-btn-danger" id="clearBtn" aria-label="Clear canvas (Delete)"><span aria-hidden="true">✕</span></button>
                        <button class="text-link" id="downloadBtn" aria-label="Download pattern">
                            Download
                        </button>
                    </div>
                </section>

                <!-- Preview Canvas -->
                <section class="canvas-section" aria-labelledby="preview-heading">
                    <div id="preview-heading" class="canvas-heading grid-control" role="region" aria-label="Preview repeats">
                        <span class="grid-control-label">Preview</span>
                        <span class="grid-dimension" id="previewRepeatXDisplay" contenteditable="true" role="textbox" aria-label="Horizontal repeats" spellcheck="false">3</span>
                        <span class="grid-control-separator">×</span>
                        <span class="grid-dimension" id="previewRepeatYDisplay" contenteditable="true" role="textbox" aria-label="Vertical repeats" spellcheck="false">3</span>
                        <span id="previewRepeatStatus" class="preview-repeat-status hint" role="status" aria-live="polite"></span>
                    </div>
                    <div class="canvas-wrapper">
                        <canvas id="previewCanvas" role="img" aria-label="Tiled pattern preview"></canvas>
                        <div id="previewToast" class="preview-toast" role="status" aria-live="polite"></div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Custom Confirmation Dialog -->
    <div id="mergeDialog" role="dialog" aria-modal="true" aria-labelledby="mergeDialogTitle" aria-describedby="mergeDialogText">
        <div>
            <h2 id="mergeDialogTitle">Merge Pattern Colors?</h2>
            <p id="mergeDialogText"></p>
            <div class="dialog-buttons">
                <button id="mergeCancelBtn">Cancel</button>
                <button id="mergeConfirmBtn" class="btn-primary">Merge</button>
            </div>
        </div>
    </div>

    <!-- Download Modal -->
    <div id="downloadModal" role="dialog" aria-modal="true" aria-labelledby="downloadModalTitle" style="display: none;">
        <div class="modal-content">
            <h2 id="downloadModalTitle">Download Pattern</h2>

            <form id="downloadForm">
                <div class="form-section">
                    <div class="form-section-label">Source</div>
                    <label class="radio-option">
                        <input type="radio" name="source" value="pattern" checked>
                        <span class="radio-option-label">Pattern</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="source" value="preview">
                        <span class="radio-option-label">Preview</span>
                    </label>
                </div>

                <div class="form-section">
                    <div class="form-section-label">Format</div>
                    <label class="radio-option">
                        <input type="radio" name="format" value="png" checked>
                        <span class="radio-option-label">PNG</span>
                    </label>
                    <label class="radio-option">
                        <input type="radio" name="format" value="svg">
                        <span class="radio-option-label">SVG</span>
                    </label>
                </div>

                <div class="form-section">
                    <label class="checkbox-option">
                        <input type="checkbox" name="rowCounts" id="rowCountsCheckbox">
                        <span class="checkbox-option-label">Include row counts</span>
                    </label>
                </div>

                <div class="modal-actions">
                    <button type="button" id="downloadModalCancelBtn" class="modal-btn modal-btn-secondary">Cancel</button>
                    <button type="submit" id="downloadModalSubmitBtn" class="modal-btn modal-btn-primary">Download</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay" aria-live="polite" aria-atomic="true" style="display: none;">
        <div class="loading-spinner"></div>
        <p id="loadingMessage">Processing...</p>
    </div>

    <script type="module" src="src/main.js"></script>
</body>
</html>
